FROM ubuntu AS base

ENV SONARURL="https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-25.3.0.104237.zip" \
    SONARHOME="sonarhome"


RUN apt update && apt install -y curl unzip && \ 
    curl -o sonarqube ${SONARURL} && \
    unzip -o sonarqube -d ${SONARHOME}


FROM eclipse-temurin:17-jre AS runtime 

COPY --from=base /sonarhome/sonarqube-* /opt/sonarqube/

# WORKDIR "/opt/sonarqube/bin/linux-x86-64"

RUN  useradd sonar && \
     chown -R sonar:sonar /opt/sonarqube/

USER sonar

ENTRYPOINT [ "sh", "-c", "/opt/sonarqube/bin/linux-x86-64/sonar.sh start" ]
