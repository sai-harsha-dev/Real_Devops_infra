FROM ubuntu AS base

ENV SONARURL="https://binaries.sonarsource.com/Distribution/sonarqube/sonarqube-25.3.0.104237.zip" \
    SONARHOME="sonarhome"

RUN apt update && apt install -y curl unzip && \ 
    curl -o sonarqube ${SONARURL} && \
    unzip -o sonarqube -d ${SONARHOME}


FROM eclipse-temurin:17-jre AS runtime 

RUN  useradd sonar

COPY --from=base --chown=sonar:sonar /sonarhome/sonarqube-* /opt/sonarqube/

# WORKDIR "/opt/sonarqube/bin/linux-x86-64"

USER sonar

ENTRYPOINT [ "/opt/sonarqube/bin/linux-x86-64/sonar.sh", "console" ]
